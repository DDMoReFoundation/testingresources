
warfarin_PK_ODE_dat = dataobj {

    SOURCE {
        file="warfarin_conc.csv"
        ignore="#"
        inputformat=nonmemFormat
    }

    DATA_INPUT_VARIABLES {
        ID : {type=categorical}
        TIME : {type=continuous}
        WT : {type=continuous}
        AMT : {type=continuous}
        DVID : {type=categorical}
        DV : {type=continuous}
        MDV : {type=categorical}
        logtWT : {type=continuous}
    }

}

warfarin_PK_ODE_par = parobj {

    STRUCTURAL {
        POP_CL : {lo=0.001, value=0.132779}
        POP_V : {lo=0.001, value=8.14751}
        POP_KA : {lo=0.001, value=1.78924}
        POP_TLAG : {lo=0.001, value=0.874897}
        BETA_CL_WT : {fix=true, value=0.75}
        BETA_V_WT : {fix=true, value=1}
    }

    VARIABILITY {
        PPV_CL : {type=SD, value=0.262728}
        PPV_V : {type=SD, value=0.136931}
        PPV_KA : {type=SD, value=0.993333}
        PPV_TLAG : {type=SD, value=0.313633}
        RUV_PROP : {type=SD, value=0.106388}
        RUV_ADD : {type=SD, value=-1.35376E-15}
        CORR_PPV_CL_V : {hi=1.0, lo=-1.0, type=CORR, value=0.2345}
    }

}

warfarin_PK_ODE_mdl = mdlobj {

    OBSERVATION {
        EPS_Y ~ {level=DV, mean=0, type=normal, var=1}
        Y : {eps=EPS_Y, error=combinedError1(additive=RUV_ADD, proportional=RUV_PROP, f=CC), prediction=CC, type=continuous}
    }

    VARIABILITY_PARAMETERS {
        PPV_CL
        PPV_V
        PPV_KA
        PPV_TLAG
        RUV_PROP
        RUV_ADD
    }

    STRUCTURAL_PARAMETERS {
        POP_CL
        POP_V
        POP_KA
        POP_TLAG
        BETA_CL_WT
        BETA_V_WT
    }

    RANDOM_VARIABLE_DEFINITION {
        ETA_CL ~ {level=ID, mean=0, sd=PPV_CL, type=normal}
        ETA_V ~ {level=ID, mean=0, sd=PPV_V, type=normal}
        ETA_KA ~ {level=ID, mean=0, sd=PPV_KA, type=normal}
        ETA_TLAG ~ {level=ID, mean=0, sd=PPV_TLAG, type=normal}
        CORR_PPV_CL_V : {level=ID, rv1=ETA_CL, rv2=ETA_V, type=CORR}
    }

    MODEL_PREDICTION {
        ODE {
            RATEIN = GUT*KA when T>=TLAG otherwise 0
            GUT : {deriv = (-RATEIN), init = 0, x0 = 0}
            CENTRAL : {deriv = (RATEIN-CL*CENTRAL/V), init = 0, x0 = 0}
        }
        CC = CENTRAL/V
    }

    MODEL_OUTPUT_VARIABLES {
        ID
        TIME
        logtWT
        CL
        V
        KA
        TLAG
        Y
    }

    MODEL_INPUT_VARIABLES {
        ID : {level=2, use=id}
        TIME : {use=idv}
        AMT : {administration=GUT, use=amt}
        DV : {level=1, prediction=Y, use=dv}
        MDV : {use=mdv}
        logtWT : {type=continuous, use=covariate}
    }

    INDIVIDUAL_VARIABLES {
        CL : {cov=[logtWT], fixEff=[BETA_CL_WT], pop=POP_CL, ranEff=ETA_CL, trans=log, type=linear}
        V : {cov=[logtWT], fixEff=[BETA_V_WT], pop=POP_V, ranEff=ETA_V, trans=log, type=linear}
        KA : {pop=POP_KA, ranEff=ETA_KA, trans=log, type=linear}
        TLAG : {pop=POP_TLAG, ranEff=ETA_TLAG, trans=log, type=linear}
    }

}

warfarin_PK_ODE_task = taskobj {

    ESTIMATE {
        target=MLXTRAN_CODE
        version="4.3.2"
        algo=["SAEM"]
    }

}

Warfarin-ODE-latest-VPC = mog { warfarin_PK_ODE_dat warfarin_PK_ODE_par warfarin_PK_ODE_mdl warfarin_PK_ODE_task }
